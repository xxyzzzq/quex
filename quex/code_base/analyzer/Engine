/* -*- C++ -*- vim: set syntax=cpp: */
#ifndef __QUEX_INCLUDE_GUARD__ANALYZER__ANALYSER
#define __QUEX_INCLUDE_GUARD__ANALYZER__ANALYSER
/****************************************************************************
 *
 * IMPORTANT NOTE:
 *
 * It is problematic to include 'Token' inside 'Analyzer'. This would create
 * problems with user defined token headers. Thus, we **must** include the
 * token class before header 'Analyser'                                     
 *
 ****************************************************************************/
#include <quex/code_base/definitions>
#include <quex/code_base/buffer/Buffer>
#include <quex/code_base/buffer/BufferFiller>

#include <quex/code_base/temporary_macros_on>

QUEX_NAMESPACE_MAIN_OPEN

    struct QUEX_TYPE_MODE_TAG;

#   define QuexAnalyzerEngine_construct              QUEX_FIX(ANALYZER_ENGINE, _construct)
#   define QuexAnalyzerEngine_destruct               QUEX_FIX(ANALYZER_ENGINE, _destruct)
#   define QuexAnalyzerEngine_reset                  QUEX_FIX(ANALYZER_ENGINE, _reset)
#   define QuexAnalyzerEngine_buffer_reload_backward QUEX_FIX(ANALYZER_ENGINE, _rebuffer_reload_backward)
#   define QuexAnalyzerEngine_buffer_reload_forward  QUEX_FIX(ANALYZER_ENGINE, _buffer_reload_forward)

    typedef struct QUEX_TYPE_ANALYZER_ENGINE_TAG {
        /* Analyzer Engine: This class provides the minimum information for the analyzis
         *                  process.                                                      */
        QUEX_TYPE_BUFFER             buffer;

        /* Each mode has a dedicated analyzer function.  The function pointer
         * to the currently active mode's function is stored redundantly in 
         * 'current_analyzer_function' to accelerate the access to it.                    */
        struct QUEX_TYPE_MODE_TAG*   __current_mode_p; 
        QUEX_TYPE_ANALYZER_FUNCTION  current_analyzer_function;

#if     defined(QUEX_OPTION_AUTOMATIC_ANALYSIS_CONTINUATION_ON_MODE_CHANGE) \
     || defined(QUEX_OPTION_ASSERTS)
        /* When a mode change happens and the user does not 'return' but 'CONTINUE'
         * an error must be logged, since the following characters are still swallowed
         * by the current function and not the new one. For this one needs to return and
         * then continue further.                                                         */
        QUEX_TYPE_ANALYZER_FUNCTION  DEBUG_analyzer_function_at_entry;
#       endif

    } QUEX_TYPE_ANALYZER_ENGINE;

    TEMPLATE_IN(InputHandleT) void
    QuexAnalyzerEngine_construct(QUEX_TYPE_ANALYZER_ENGINE*   me,
                                 QUEX_TYPE_ANALYZER_FUNCTION  AnalyserFunction,
                                 InputHandleT*                input_handle,
                                 QUEX_TYPE_CHARACTER*         InputMemory,
                                 const size_t                 BufferMemorySize,
                                 const char*                  CharacterEncodingName, 
                                 const size_t                 TranslationBufferMemorySize,
                                 bool                         ByteOrderReversionF);

    QUEX_INLINE void 
    QuexAnalyzerEngine_destruct(QuexAnalyzerEngine* me);

    TEMPLATE_IN(InputHandleT) void
    QuexAnalyzerEngine_reset(QUEX_TYPE_ANALYZER_ENGINE*   me,
                             QUEX_TYPE_ANALYZER_FUNCTION  AnalyserFunction,
                             InputHandleT*                input_handle, 
                             const char*                  CharacterEncodingName, 
                             const size_t                 TranslationBufferMemorySize);

    QUEX_INLINE bool 
    QuexAnalyzerEngine_buffer_reload_backward(QuexBuffer* buffer);

    QUEX_INLINE bool 
    QuexAnalyzerEngine_buffer_reload_forward(QuexBuffer*         buffer, 
                                   QUEX_TYPE_CHARACTER_POSITION* last_acceptance_input_position,
                                   QUEX_TYPE_CHARACTER_POSITION* post_context_start_position,
                                   const size_t                  PostContextN);


QUEX_NAMESPACE_MAIN_CLOSE

#include <quex/code_base/temporary_macros_off>

#endif /* __QUEX_INCLUDE_GUARD__ANALYZER__ANALYSER */
