/* -*- C++ -*-  vim: set syntax=cpp:
 * (C) 2007-2008 Frank-Rene Schaefer  */
#ifndef __INCLUDE_GUARD__QUEX_BUFFER_CONVERTER__
#define __INCLUDE_GUARD__QUEX_BUFFER_CONVERTER__

#include <quex/code_base/buffer/iconv/Converter>

#if ! defined (__QUEX_SETTING_PLAIN_C)
    extern "C" { 
#   include <iconv.h>
    }
#   include <cstddef>
#else
#   include <iconv.h>
#   include <stddef.h>     /* gets: ptrdiff_t */
#endif


#if ! defined (__QUEX_SETTING_PLAIN_C)
namespace quex {
#endif

    typedef struct {
        QuexConverter  base;

        iconv_t        handle;

    } QuexConverter_IConv;

    TEMPLATE_IN(InputHandleT) void
    QuexBufferFiller_Converter_IConv_construct(TEMPLATED(QuexBufferFiller_IConv)* me,
                                               InputHandleT* input_handle, 
                                               const char* FromCoding,   const char* ToCoding,
                                               size_t      RawBufferSize);
    /* input_handle         is the file handle or pointer to stream from which characters come.
     *
     * ToCoding == 0x0      causes an automatic choice of the target coding to according to 
     *                      the value of 'sizeof(QUEX_CHARACTER_TYPE)'.                  
     *
     * raw_buffer_p == 0x0  causes a dynamic allocation of the intermediate translation
     *                      buffer. The ownership in this case remains inside the 'filler'
     *                      and the buffer is destroyed as soon as the filler is destroyed.  
     *              != 0x0  leaves the ownership of the buffer to the caller of this function.
     *                      Memory is not freed on destruction.
     */


#if ! defined(__QUEX_SETTING_PLAIN_C)
}
#endif

#endif /* __INCLUDE_GUARD__QUEX_BUFFER_CONVERTER__ */
