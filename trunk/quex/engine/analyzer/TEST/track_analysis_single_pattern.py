#! /usr/bin/env python
# -*- coding: utf8 -*-
import os
import sys
sys.path.insert(0, os.environ["QUEX_PATH"])

import quex.input.regular_expression.engine                   as     regex
import quex.engine.analyzer.core                              as     core
import quex.engine.state_machine.algorithm.acceptance_pruning as     acceptance_pruning
from   quex.blackboard                                        import E_InputActions
import help

choice_str = "CHOICES: 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10;"
choice     = sys.argv[1]

pattern_db = {
    "0": [ 'a/bc',     ],      
    #  ┌────┐  a   ┌────┐  b   ┌────┐  c   ┌────┐
    #  │ 28 │ ───▶ │ 29 │ ───▶ │ 30 │ ───▶ │ 31 │
    #  └────┘      └────┘S     └────┘      └────┘A,R
    #____________________________________________________________________________________

    "1": [ 'a+/bc',     ],     
    #                  a
    #                ┌───┐
    #                ▼   │
    #  ┌────┐  a   ┌───────┐  b   ┌────┐  c   ┌────┐
    #  │ 39 │ ───▶ │  40   │ ───▶ │ 41 │ ───▶ │ 42 │
    #  └────┘      └───────┘S     └────┘      └────┘A,R
    #____________________________________________________________________________________

    "2": [ 'a/bc+',     ],     
    #                                          c
    #                                        ┌───┐
    #                                        ▼   │
    #  ┌────┐  a   ┌────┐  b   ┌────┐  c   ┌───────┐
    #  │ 39 │ ───▶ │ 40 │ ───▶ │ 41 │ ───▶ │  42   │
    #  └────┘      └────┘S     └────┘      └───────┘A,R
    #  
    #____________________________________________________________________________________

    "3": [ '(a+|bc)/d+', ],    
    #                                                   d
    #                                                 ┌───┐
    #                                                 ▼   │
    #        ┌───────┐  b   ┌────┐  c   ┌────┐  d   ┌───────┐
    #    ┌── │  69   │ ───▶ │ 71 │ ───▶ │ 72 │ ───▶ │  73   │
    #    │   └───────┘      └────┘      └────┘S     └───────┘A,R
    #    │       a                                    ▲
    #    │ a   ┌───┐                                  │
    #    │     ▼   │                                  │
    #    │   ┌───────┐  d                             │
    #    └─▶ │  70   │ ───────────────────────────────┘
    #        └───────┘S
    #____________________________________________________________________________________

    "4": [ 'x/a/b',     ],     
    #  ┌────┐  a   ┌────┐  b   ┌────┐
    #  │ 30 │ ───▶ │ 31 │ ───▶ │ 32 │
    #  └────┘      └────┘S     └────┘A,R
    #____________________________________________________________________________________

    "5": [ 'x/(a+|bc)/d+f', ], 
    #                                                   d
    #                                                 ┌───┐
    #                                                 ▼   │
    #        ┌───────┐  b   ┌────┐  c   ┌────┐  d   ┌───────┐  f   ┌────┐
    #    ┌── │  92   │ ───▶ │ 94 │ ───▶ │ 95 │ ───▶ │  96   │ ───▶ │ 97 │
    #    │   └───────┘      └────┘      └────┘S     └───────┘      └────┘A,R
    #    │       a                                    ▲
    #    │ a   ┌───┐                                  │
    #    │     ▼   │                                  │
    #    │   ┌───────┐  d                             │
    #    └─▶ │  93   │ ───────────────────────────────┘
    #        └───────┘S
    #____________________________________________________________________________________

    "6": [ 'a' ],
    #  ┌───┐  a   ┌───┐
    #  │ 7 │ ───▶ │ 8 │
    #  └───┘      └───┘A
    #____________________________________________________________________________________

    "7": [ 'aa?' ],
    #  ┌────┐  a   ┌────┐  a   ┌────┐
    #  │ 16 │ ───▶ │ 17 │ ───▶ │ 18 │
    #  └────┘      └────┘A     └────┘A
    #____________________________________________________________________________________

    "8": [ 'a|(bc)' ],
    #         a
    #    ┌───────────────────────┐
    #    │                       ▼
    #  ┌────┐  b   ┌────┐  c   ┌────┐
    #  │ 34 │ ───▶ │ 36 │ ───▶ │ 35 │
    #  └────┘      └────┘      └────┘A
    #____________________________________________________________________________________

    "9": [ 'a|(a(a|(bc))e)' ],
    #                     a
    #                ┌───────────────────────┐
    #                │                       ▼
    #  ┌────┐  a   ┌────┐  b   ┌────┐  c   ┌────┐  e   ┌────┐
    #  │ 79 │ ───▶ │ 80 │ ───▶ │ 82 │ ───▶ │ 81 │ ───▶ │ 83 │
    #  └────┘      └────┘A     └────┘      └────┘      └────┘A
    #____________________________________________________________________________________
    "10": [ 'aa(ba)*' ],
    #                     b
    #                 ┌──────────┐
    #                 ▼          │
    #    ┌───┐  a   ┌───┐  a   ┌───┐
    #    │ 0 │ ───▶ │ 1 │ ───▶ │ 2 │
    #    └───┘      └───┘      └───┘A
    #____________________________________________________________________________________
}

if __name__ == "__main__":
    if "--hwut-info" in sys.argv:
        print "Track Analysis: Single Pattern Checks;"
        print choice_str
        sys.exit()

    acceptance_pruning._deactivated_for_unit_test_f = True

    sm = help.prepare(pattern_db[choice])

    # For DEBUG purposes: specify 'DRAW' on command line
    help.if_DRAW_in_sys_argv(sm)
    help.test_track_analysis(sm)
