// -*- C++ -*- vim: set syntax=cpp: 
start = MAIN;

header {
#include <fstream>
}

body {
    std::string file_name;
    size_t      include_depth;
}

init {
    include_depth = 0;
}


memento {
    std::string     file_name;
    std::ifstream*  included_sh;
}

memento_pack {
    memento->file_name = self.file_name;
    for(size_t i=0; i<=self.include_depth; ++i) std::cout << "    ";
    std::cout << "Memento: including from " << self.file_name << std::endl;
    self.include_depth += 1;
    /* store stream handle for 'close' on end of file */
    memento->included_sh = InputH;
}

memento_unpack {
    self.file_name = memento->file_name;
    for(size_t i=0; i<=self.include_depth; ++i) std::cout << "    ";
    std::cout << "Memento: return to " << self.file_name << std::endl;
    self.include_depth -= 1;
    /* 'close' on end of file */
    memento->included_sh->close();
    delete (memento->included_sh);
}

token {
   INCLUDE
   IDENTIFIER
   WHITESPACE
   STRING
}

mode MAIN
{
    <<EOF>>         => QUEX_TKN_TERMINATION(LexemeNull);
    //
    "include"       => QUEX_TKN_INCLUDE(LexemeNull); 
    //
    [_a-zA-Z0-9.]+  => QUEX_TKN_IDENTIFIER(Lexeme); 
    [ \t\r\n]+      {}
}



